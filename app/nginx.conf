server {
    listen 80;
    server_name localhost;

    root /usr/share/nginx/html;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }

    # Cache assets
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, no-transform";
    }

    # Proxy for Myrient (CORS Bypass)
    location ^~ /myrient/ {
        resolver 8.8.8.8;
        # Use simpler proxy_pass with trailing slash which does implicit rewrite
        proxy_pass https://myrient.erista.me/;
        proxy_set_header Host myrient.erista.me;
        # Spoof Referer to bypass hotlink protection
        proxy_set_header Referer "https://myrient.erista.me/";
        proxy_ssl_server_name on;
        proxy_ssl_protocols TLSv1.2 TLSv1.3;
    }

    # Proxy for TheGamesDB (Metadata)
    location ^~ /tgdb/ {
        resolver 8.8.8.8;
        rewrite ^/tgdb/(.*) /$1 break;
        proxy_pass https://api.thegamesdb.net;
        proxy_set_header Host api.thegamesdb.net;
        proxy_ssl_server_name on;
        proxy_ssl_protocols TLSv1.2 TLSv1.3;
    }

    # Proxy for RetroAchievements
    location ^~ /ra/ {
        resolver 8.8.8.8;
        rewrite ^/ra/(.*) /$1 break;
        proxy_pass https://retroachievements.org;
        proxy_set_header Host retroachievements.org;
        proxy_ssl_server_name on;
        proxy_ssl_protocols TLSv1.2 TLSv1.3;
    }

    # Proxy for TheGamesDB CDN (Images)
    location ^~ /tgdb-cdn/ {
        resolver 8.8.8.8;
        # Use simpler proxy_pass with trailing slash which does implicit rewrite
        proxy_pass https://cdn.thegamesdb.net/;
        proxy_set_header Host cdn.thegamesdb.net;
        proxy_ssl_server_name on;
        proxy_ssl_protocols TLSv1.2 TLSv1.3;
    }
}
